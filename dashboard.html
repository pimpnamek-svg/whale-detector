<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Liquidity Grab Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0e1117;
    color: #e6e6e6;
    margin: 0;
    padding: 20px;
  }

  h1 {
    margin-bottom: 5px;
    font-size: 1.6rem;
  }

  .sub {
    color: #9aa4b2;
    margin-bottom: 20px;
    font-size: 0.9rem;
  }

  .panel {
    background: #161b22;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 16px;
    border: 1px solid #222;
  }

  .panel h2 {
    margin-top: 0;
    font-size: 1.1rem;
    margin-bottom: 10px;
  }

  .status {
    font-size: 1.2rem;
    font-weight: bold;
  }

  .locked { color: #ff6b6b; }
  .caution { color: #feca57; }
  .allowed { color: #1dd1a1; }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }

  th, td {
    padding: 8px;
    border-bottom: 1px solid #222;
    text-align: left;
  }

  th {
    color: #9aa4b2;
    font-weight: 500;
  }

  input, button {
    background: #0e1117;
    color: #e6e6e6;
    border: 1px solid #333;
    padding: 8px;
    border-radius: 6px;
    font-size: 0.9rem;
  }

  button {
    cursor: pointer;
  }

  button:hover {
    background: #1a1f27;
  }

  .note {
    font-size: 0.75rem;
    color: #9aa4b2;
    margin-top: 6px;
  }

  .footer {
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 20px;
    text-align: center;
  }
</style>
</head>

<body>

<h1>Liquidity Grab Dashboard</h1>
<div class="sub">Decision support · No execution · Discipline first</div>

<!-- PANEL 1: BTC GATE -->
<div class="panel">
  <h2>Market Permission (BTC Gate)</h2>
  <div id="btcStatus" class="status">Loading…</div>
</div>

<!-- PANEL 2: TOKEN WHALES -->
<div class="panel">
  <h2>Whale Activity (Tokens)</h2>
  <table id="tokenTable">
    <thead>
      <tr>
        <th>Token</th>
        <th>State</th>
        <th>Volume Ratio</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="3">Loading…</td></tr>
    </tbody>
  </table>
</div>

<!-- PANEL 3: MANUAL EVALUATION -->
<div class="panel">
  <h2>Manual Trade Evaluation</h2>

  <input id="symbolInput" placeholder="Symbol (e.g. SOL/USDT)" />
  <button onclick="evaluate()">Evaluate</button>

  <pre id="evalResult"></pre>

  <div class="note">
    Risk / reward boundaries are ATR-based context only.  
    Not entry or exit instructions.
  </div>
</div>

<!-- PANEL 4: SYSTEM HEALTH -->
<div class="panel">
  <h2>System Health</h2>
  <div id="health">Checking…</div>
</div>

<div class="footer">
  Built for discipline · Not prediction
</div>

<script>
const API = "https://YOUR_APP_URL"; // ← CHANGE THIS

async function loadBTC() {
  const res = await fetch(`${API}/whale-status`);
  const data = await res.json();

  const el = document.getElementById("btcStatus");
  el.textContent = data.whale_state + " — " + data.entry_permission;

  el.className = "status " +
    (data.entry_permission === "ALLOWED" ? "allowed" :
     data.whale_state === "TRANSITION" ? "caution" : "locked");
}

async function loadTokens() {
  const res = await fetch(`${API}/token-whales`);
  const data = await res.json();

  const tbody = document.querySelector("#tokenTable tbody");
  tbody.innerHTML = "";

  if (!data.tokens || data.tokens.length === 0) {
    tbody.innerHTML = `<tr><td colspan="3">No actionable whale activity</td></tr>`;
    return;
  }

  data.tokens.forEach(t => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${t.symbol}</td>
      <td>${t.state}</td>
      <td>${t.volume_ratio ?? "-"}</td>
    `;
    tbody.appendChild(row);
  });
}

async function evaluate() {
  const symbol = document.getElementById("symbolInput").value.trim();
  if (!symbol) return;

  const res = await fetch(`${API}/evaluate-trade?symbol=${symbol}`);
  const data = await res.json();

  document.getElementById("evalResult").textContent =
    JSON.stringify(data, null, 2);
}

async function loadHealth() {
  const res = await fetch(`${API}/heartbeat`);
  const data = await res.json();
  document.getElementById("health").textContent =
    "Last data update: " + new Date(data.last_data_update_at * 1000).toLocaleTimeString();
}

async function refreshAll() {
  await loadBTC();
  await loadTokens();
  await loadHealth();
}

refreshAll();
setInterval(refreshAll, 60000);
</script>

</body>
</html>
